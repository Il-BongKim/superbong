# selectedPositions

fragment.xml ←—> fragment.viewModel . ( viewmodel.selectedPositions )

fragment.viewModel → onItemClick()  selectPosition ( value update ( event ))

fragment.viewModel ← fragment ← adapter ← listener ← item ( event )

아이탬 이벤트가 발생하면 , 플래그먼트 뷰 모델에서  selectPosition  값을 업데이트 한다.

```
<androidx.recyclerview.widget.RecyclerView
    android:id="@id/recycler"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:clipToPadding="false"
    android:paddingBottom="37dp"
    android:paddingStart="@dimen/item_margin_grid_rl"
    android:paddingEnd="@dimen/item_margin_grid_rl"
    android:scrollbars="none"
    app:m4u_my_genre_list="@{viewmodel.items}"
    **app:selectedPositions="@{viewmodel.selectedPositions}" />**
```

bindingAdapter() 를 통해 

1. 뷰모델의 **selectedPositions 값 변경** 
2. **app:selectedPositions** 바인드 메서드 호출

```
@BindingAdapter("app:selectedPositions")
fun setSelected(recyclerView: androidx.recyclerview.widget.RecyclerView, selectedPositions: ArrayList<Int>) {
    **val adapter = recyclerView.adapter as BaseRecyclerAdapter**
    val removeList = ArrayList<Int>(adapter.selectedPositions)
    val addList = ArrayList<Int>(selectedPositions)

    removeList.removeAll(selectedPositions)    // 체크 해제 할거
    addList.removeAll(adapter.selectedPositions) // 체크할 거

    adapter.selectedPositions.removeAll(removeList)
    adapter.selectedPositions.addAll(addList)
    for (position in removeList) {
        adapter.notifyItemChanged(position)
    }
    for (position in addList) {
        adapter.notifyItemChanged(position)
    }
}
```

Fragment.viewModel of selectPosition  → RecyclerView.adapter of selectPosition  설정

RecyclerView.adapter 의 notifyItemChange 를 통해 .

RecyclerView

Adapter.onBindViewHolder → holder.viewHolderManager.setIsSelect(selectedPositions.contains(position), holder.itemView)

MyArtistVHManager

```
override fun setIsSelect(isSelect: Boolean, itemView: View?) {

    itemView?.let { view ->
        view.isSelected = isSelect
        viewModel.setIsSelect(isSelect)
    }
}
```

viewModel

```
fun setIsSelect(isSelect: Boolean) {

    if (isSelect) {
        typeface.set(Typeface.BOLD)
    } else {
        typeface.set(Typeface.NORMAL)
    }
}
```

XML

```
<TextView
    android:id="@+id/text_title"
    style="@style/title.list.line2"
    android:textSize="13sp"
    android:gravity="center_horizontal"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="@{viewmodel.title}"
    app:text_typeface="@{viewmodel.typeface}"
    app:layout_constraintBottom_toTopOf="@+id/guide_item_bottom"
    app:layout_constraintEnd_toEndOf="@+id/guide_info_end"
    app:layout_constraintStart_toStartOf="@+id/guide_info_begin"
    app:layout_constraintTop_toBottomOf="@+id/lay_cover" />
```

dataBinding

```
@BindingAdapter("app:text_typeface")
fun setTextViewTypeface(textView: TextView, typeface: Int) {
    //TODO Bugs5 베타용 임시 코드. 추후 동적으로 변경가능하도록 변경
    var font: Typeface? = null
    if (BugsPreference.USE_BUGS_FONT) {
        if (typeface == Typeface.BOLD) {
            font = BugsPreference.getBugsTypefaceBold(textView.context)
        } else {
            font = BugsPreference.getBugsTypeface(textView.context)
        }
    }
    textView.setTypeface(font, typeface)
}
```

총 2가지의 구현

플레그먼트 와 어뎁터 연결

1. 어뎁터의 아이탬 뷰모델, 플래그먼트 뷰모델 아이탬 클릭 이벤트 연결
2. (item.xml ←→ itemViewModel) ← listener → adapter(onbindView) → fragment.viewmodel 
3. fragment.viewModel.**selectedPositions 갱신**

adapter **selectedPositions**

1. adapter onBindView 에서 해당 값이 선택되었는지 여뷰를 itemViewModel 에 전달.

DataBinding 통해 ( fragmentViewModel.**selectedPositions**   ←→ adapter.**selectedPositions )**

Adapter 라면 

Adapter.notify → 위에서 구현한 onBindView 에서 adapter.**selectedPositions 을 보고** 

선택되었는지를 Adapter 의 itemView 에 전달하고  전달받은 값에 따라 표시한다.